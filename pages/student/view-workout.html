<div class="student-view-workout">
  <header>
    <h1>Visualizar Treino</h1>
    <nav>
      <a href="#/student/dashboard">Meus Treinos</a>
      <a href="#" id="logoutBtn">Sair</a>
    </nav>
  </header>

  <!-- Loading inicial -->
  <div id="pageLoading" style="text-align: center; padding: 50px;">
    <div class="spinner" style="margin: 0 auto;"></div>
    <p>Carregando treino...</p>
  </div>

  <!-- Conte√∫do -->
  <div id="mainContent" style="display: none; max-width: 900px; margin: 30px auto;">
    <div id="workoutContainer"></div>
  </div>
</div>

<script>
(async function() {
  console.log('=== VISUALIZAR TREINO - INICIANDO ===');

  // Aguardar DOM
  await new Promise(resolve => {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', resolve);
    } else {
      resolve();
    }
  });

  await new Promise(resolve => setTimeout(resolve, 100));

  console.log('‚úì DOM pronto');

  // Logout
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      await authManager.logout();
      router.goToLogin();
    });
  }

  // Mapeamento de dias
  const daysMap = {
    monday: 'Segunda-feira',
    tuesday: 'Ter√ßa-feira',
    wednesday: 'Quarta-feira',
    thursday: 'Quinta-feira',
    friday: 'Sexta-feira',
    saturday: 'S√°bado',
    sunday: 'Domingo'
  };

  const daysOrder = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

  // Fun√ß√£o para trocar de dia
  window.switchDayFunc = function(day) {
    console.log('Trocando para dia:', day);
    
    // Remover active de todos
    document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.day-content').forEach(content => content.classList.remove('active'));

    // Adicionar active ao selecionado
    const targetBtn = document.querySelector(`.day-btn[data-day="${day}"]`);
    const targetContent = document.querySelector(`.day-content[data-day="${day}"]`);
    
    if (targetBtn) targetBtn.classList.add('active');
    if (targetContent) targetContent.classList.add('active');
  };

  // Carregar treino
  async function loadWorkout() {
    const workoutId = sessionStorage.getItem('viewWorkoutId');
    const container = document.getElementById('workoutContainer');
    
    if (!workoutId) {
      container.innerHTML = '<p>‚ùå Treino n√£o encontrado.</p>';
      document.getElementById('pageLoading').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      return;
    }

    try {
      console.log('Carregando treino:', workoutId);
      const workout = await dbManager.getWorkoutById(workoutId);
      console.log('Treino carregado:', workout);
      
      if (!workout) {
        container.innerHTML = '<p>‚ùå Treino n√£o encontrado.</p>';
        document.getElementById('pageLoading').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        return;
      }

      // Renderizar treino
      let html = '<div class="workout-header">';
      html += '<h2>' + workout.name + '</h2>';
      html += '<p>' + workout.description + '</p>';
      html += '</div>';

      // Filtrar dias com exerc√≠cios
      const daysWithExercises = daysOrder.filter(day => 
        workout.days && workout.days[day] && workout.days[day].length > 0
      );
      
      console.log('Dias com exerc√≠cios:', daysWithExercises);

      if (daysWithExercises.length === 0) {
        html += '<p>Este treino n√£o possui exerc√≠cios.</p>';
      } else {
        // Navega√ß√£o de dias
        html += '<div class="days-navigation">';
        daysWithExercises.forEach((day, index) => {
          html += `<button class="day-btn${index === 0 ? ' active' : ''}" data-day="${day}" onclick="switchDayFunc('${day}')">${daysMap[day]}</button>`;
        });
        html += '</div>';

        // Conte√∫do de cada dia
        for (let i = 0; i < daysWithExercises.length; i++) {
          const day = daysWithExercises[i];
          const exercises = workout.days[day];
          
          html += `<div class="day-content${i === 0 ? ' active' : ''}" data-day="${day}">`;
          html += '<h3>' + daysMap[day] + '</h3>';
          html += '<div class="exercises-for-day">';

          for (const exercise of exercises) {
            html += '<div class="exercise-card">';
            html += '<h4>' + exercise.exerciseName + '</h4>';
            
            html += '<div class="sets-reps">';
            html += '<strong>S√©ries:</strong> ' + exercise.sets + ' | ';
            html += '<strong>Repeti√ß√µes:</strong> ' + exercise.reps;
            html += '</div>';

            if (exercise.notes && exercise.notes.trim() !== '') {
              html += '<div class="notes">';
              html += '<strong>Observa√ß√µes:</strong> ' + exercise.notes;
              html += '</div>';
            }

            // V√≠deo
            if (exercise.videoUrl && exercise.videoUrl.trim() !== '') {
              html += '<div class="video-container">';
              html += '<iframe src="' + exercise.videoUrl + '" allowfullscreen></iframe>';
              html += '</div>';
            } else {
              html += '<p style="color: #999; font-size: 12px; margin-top: 10px;">üìπ Sem v√≠deo dispon√≠vel</p>';
            }

            html += '</div>';
          }

          html += '</div>';
          html += '</div>';
        }
      }

      container.innerHTML = html;
      console.log('‚úì Treino renderizado');

      // Mostrar conte√∫do
      document.getElementById('pageLoading').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';

      console.log('=== VISUALIZA√á√ÉO COMPLETA ===');
    } catch (error) {
      console.error('‚ùå Erro ao carregar treino:', error);
      container.innerHTML = `
        <div class="card" style="border-color: #cc0000;">
          <p style="color: #cc0000;">
            <strong>‚ùå Erro ao carregar treino.</strong><br>
            ${error.message}
          </p>
        </div>
      `;
      document.getElementById('pageLoading').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
    }
  }

  // Carregar treino
  await loadWorkout();
})();
</script>