<div class="student-view-workout">
  <header>
    <h1>Visualizar Treino</h1>
    <nav>
      <a href="#/student/dashboard">Meus Treinos</a>
      <a href="#" id="logoutBtn">Sair</a>
    </nav>
  </header>

  <div style="max-width: 900px; margin: 30px auto;">
    <div id="workoutContainer">
      <div class="loading"><div class="spinner"></div><p>Carregando...</p></div>
    </div>
  </div>
</div>

<script>
  // Logout
  document.getElementById('logoutBtn').addEventListener('click', async (e) => {
    e.preventDefault();
    await authManager.logout();
    router.goToLogin();
  });

  // Mapeamento de nomes dos dias
  const dayNames = {
    monday: 'Segunda-feira',
    tuesday: 'Terça-feira',
    wednesday: 'Quarta-feira',
    thursday: 'Quinta-feira',
    friday: 'Sexta-feira',
    saturday: 'Sábado',
    sunday: 'Domingo'
  };

  const dayOrder = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

  // Carregar treino
  async function loadWorkout() {
    const workoutId = sessionStorage.getItem('viewWorkoutId');
    const container = document.getElementById('workoutContainer');
    
    if (!workoutId) {
      container.innerHTML = '<p>Treino não encontrado.</p>';
      return;
    }

    try {
      const workout = await dbManager.getWorkoutById(workoutId);
      
      if (!workout) {
        container.innerHTML = '<p>Treino não encontrado.</p>';
        return;
      }

      // Renderizar treino
      let html = '<div class="workout-header">';
      html += '<h2>' + workout.name + '</h2>';
      html += '<p>' + workout.description + '</p>';
      html += '</div>';

      // Criar navegação de dias
      const daysWithExercises = dayOrder.filter(day => workout.days[day] && workout.days[day].length > 0);
      
      if (daysWithExercises.length === 0) {
        html += '<p>Este treino não possui exercícios.</p>';
      } else {
        html += '<div class="days-navigation">';
        daysWithExercises.forEach((day, index) => {
          html += '<button class="day-btn' + (index === 0 ? ' active' : '') + '" onclick="switchDay(\'' + day + '\')">' + dayNames[day] + '</button>';
        });
        html += '</div>';

        // Renderizar conteúdo de cada dia
        for (let i = 0; i < daysWithExercises.length; i++) {
          const day = daysWithExercises[i];
          html += '<div class="day-content' + (i === 0 ? ' active' : '') + '" data-day="' + day + '">';
          html += '<h3>' + dayNames[day] + '</h3>';
          html += '<div class="exercises-for-day">';

          for (const exercise of workout.days[day]) {
            html += '<div class="exercise-card">';
            html += '<h4>' + exercise.exerciseName + '</h4>';
            
            html += '<div class="sets-reps">';
            html += '<strong>Séries:</strong> ' + exercise.sets + ' | ';
            html += '<strong>Repetições:</strong> ' + exercise.reps;
            html += '</div>';

            if (exercise.notes) {
              html += '<div class="notes">';
              html += '<strong>Observações:</strong> ' + exercise.notes;
              html += '</div>';
            }

            // Adicionar vídeo se disponível
            if (exercise.videoUrl && exercise.videoUrl.trim() !== '') {
              html += '<div class="video-container">';
              html += '<iframe src="' + exercise.videoUrl + '" allowfullscreen></iframe>';
              html += '</div>';
            }

            html += '</div>';
          }

          html += '</div>';
          html += '</div>';
        }
      }

      container.innerHTML = html;
    } catch (error) {
      console.error('Erro ao carregar treino:', error);
      container.innerHTML = '<p>Erro ao carregar treino.</p>';
    }
  }

  // Trocar dia
  function switchDay(day) {
    // Remover classe active de todos os botões e conteúdos
    document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.day-content').forEach(content => content.classList.remove('active'));

    // Adicionar classe active ao botão e conteúdo selecionado
    document.querySelectorAll('.day-btn').forEach(btn => {
      if (btn.textContent.toLowerCase().includes(dayNames[day].split('-')[0])) {
        btn.classList.add('active');
      }
    });

    const targetContent = document.querySelector('[data-day="' + day + '"]');
    if (targetContent) {
      targetContent.classList.add('active');
    }
  }

  // Carregar treino quando página for carregada
  loadWorkout();
</script>