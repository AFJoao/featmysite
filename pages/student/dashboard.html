<div class="student-dashboard">
  <header>
    <h1>Aluno - Meus Treinos</h1>
    <nav>
      <a href="#" id="logoutBtn">Sair</a>
    </nav>
  </header>

  <div style="max-width: 1000px; margin: 30px auto;">
    <h2>Bem-vindo, <span id="studentName">Carregando...</span>!</h2>
    
    <h3 style="margin-top: 30px; margin-bottom: 15px;">Treinos Atribu√≠dos</h3>
    <div id="workoutsList" class="workouts-list">
      <div class="loading"><div class="spinner"></div><p>Carregando treinos...</p></div>
    </div>
  </div>
</div>

<script>
(async function() {
  console.log('=== DASHBOARD DO ALUNO - INICIANDO ===');

  // Aguardar DOM
  await new Promise(resolve => {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', resolve);
    } else {
      resolve();
    }
  });

  await new Promise(resolve => setTimeout(resolve, 100));

  console.log('‚úì DOM pronto');

  // Logout
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      console.log('Fazendo logout...');
      await authManager.logout();
      router.goToLogin();
    });
  }

  // Mapeamento de dias
  const daysMap = {
    monday: 'Segunda',
    tuesday: 'Ter√ßa',
    wednesday: 'Quarta',
    thursday: 'Quinta',
    friday: 'Sexta',
    saturday: 'S√°bado',
    sunday: 'Domingo'
  };

  // Fun√ß√£o para visualizar treino
  window.viewWorkoutFunc = function(workoutId) {
    console.log('Visualizando treino:', workoutId);
    sessionStorage.setItem('viewWorkoutId', workoutId);
    router.goToViewWorkout();
  };

  // Carregar dados do Aluno
  async function loadStudentData() {
    try {
      console.log('Carregando dados do aluno...');
      
      const studentNameSpan = document.getElementById('studentName');
      if (!studentNameSpan) return;

      const userData = await dbManager.getCurrentUserData();
      console.log('Dados do aluno:', userData);
      
      if (userData) {
        studentNameSpan.textContent = userData.name || 'Aluno';
      }

      console.log('‚úì Dados do aluno carregados');
    } catch (error) {
      console.error('‚ùå Erro ao carregar dados:', error);
    }
  }

  // Carregar treinos
  async function loadWorkouts() {
    try {
      console.log('=== CARREGANDO TREINOS DO ALUNO ===');
      
      const workoutsList = document.getElementById('workoutsList');
      if (!workoutsList) return;

      const workouts = await dbManager.getStudentWorkouts();
      console.log('Treinos retornados:', workouts);

      if (workouts.length === 0) {
        workoutsList.innerHTML = `
          <div class="card" style="background-color: #f5f5f5;">
            <p style="margin: 0; color: #666;">
              Nenhum treino atribu√≠do ainda.<br>
              Aguarde seu Personal Trainer atribuir um treino a voc√™.
            </p>
          </div>
        `;
      } else {
        workoutsList.innerHTML = workouts.map(workout => {
          // Contar dias com exerc√≠cios
          const daysWithExercises = Object.keys(workout.days || {}).filter(day => {
            return workout.days[day] && workout.days[day].length > 0;
          }).map(day => daysMap[day] || day);

          return `
            <div class="card">
              <h4>${workout.name}</h4>
              <p>${workout.description || 'Sem descri√ß√£o'}</p>
              <p><strong>Dias:</strong> ${daysWithExercises.length > 0 ? daysWithExercises.join(', ') : 'Nenhum dia definido'}</p>
              <div style="margin-top: 10px;">
                <button 
                  class="view-workout-btn secondary" 
                  data-workout-id="${workout.id}"
                  onclick="viewWorkoutFunc('${workout.id}')">
                  üëÅÔ∏è Ver Treino
                </button>
              </div>
            </div>
          `;
        }).join('');
      }

      console.log('‚úì Treinos carregados');
    } catch (error) {
      console.error('‚ùå Erro ao carregar treinos:', error);
      const workoutsList = document.getElementById('workoutsList');
      if (workoutsList) {
        workoutsList.innerHTML = `
          <div class="card" style="border-color: #cc0000;">
            <p style="color: #cc0000;">
              <strong>‚ùå Erro ao carregar treinos.</strong><br>
              ${error.message}
            </p>
          </div>
        `;
      }
    }
  }

  // Carregar tudo
  await loadStudentData();
  await loadWorkouts();

  console.log('=== DASHBOARD DO ALUNO CARREGADO ===');
})();
</script>