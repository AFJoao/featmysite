match /feedbacks/{feedbackId} {

  // LEITURA:
  // - aluno pode ler seus próprios feedbacks
  // - personal pode ler feedback se for o personal do treino
  allow read: if request.auth != null &&
    (
      resource.data.studentId == request.auth.uid ||
      (
        resource.data.workoutId != null &&
        exists(/databases/$(database)/documents/workouts/$(resource.data.workoutId)) &&
        get(/databases/$(database)/documents/workouts/$(resource.data.workoutId)).data.personalId == request.auth.uid
      )
    );

  // CRIAR: apenas o próprio aluno
  allow create: if request.auth != null &&
                   request.resource.data.studentId == request.auth.uid;

  // Feedback é imutável
  allow update, delete: if false;
}